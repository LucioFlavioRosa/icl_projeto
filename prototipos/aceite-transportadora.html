<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Aceite da Transportadora | Gestão de Fretes</title>
  <!-- Estilos herdados do template -->
  <link rel="stylesheet" href="https://bra.icl-group.com/wp-content/themes/hello-elementor/style.css?ver=6.8.3">
  <link rel="stylesheet" href="https://bra.icl-group.com/wp-content/themes/icl/css/general.min.css?ver=1761724536">
  <link rel="stylesheet" href="https://bra.icl-group.com/wp-content/themes/icl/css/new-styles.min.css?ver=1761724536">
  <link rel="stylesheet" href="https://bra.icl-group.com/wp-content/themes/icl/css/sustainability-page.min.css?ver=1761724536">
  <link rel="stylesheet" href="https://bra.icl-group.com/wp-content/plugins/elementor/assets/lib/font-awesome/css/all.min.css?ver=3.32.5">
  <style>
    body { background: #f7fafd; font-family: 'Inter', 'Demo', Arial, sans-serif; }
    .container-main { max-width: 520px; margin: 48px auto 0 auto; background: #fff; border-radius: 18px; box-shadow: 0 8px 32px rgba(0,0,0,0.09); padding: 36px 32px 32px 32px; }
    .titulo { font-size: 2rem; color: #00B5D3; font-weight: 400; margin-bottom: 12px; }
    .subtitulo { color: #002846; font-size: 1.1rem; margin-bottom: 28px; }
    .detalhes-transporte { background: #f0f7fa; border-radius: 10px; padding: 18px 16px; margin-bottom: 28px; }
    .detalhes-transporte dt { color: #00B5D3; font-weight: 500; font-size: 1rem; }
    .detalhes-transporte dd { margin: 0 0 10px 0; color: #002846; font-size: 1rem; }
    form { display: flex; flex-direction: column; gap: 18px; }
    .form-group { display: flex; flex-direction: column; }
    label { font-weight: 500; color: #002846; margin-bottom: 6px; }
    input[type="text"], input[type="tel"] { padding: 10px 12px; border: 1px solid #00B5D3; border-radius: 8px; font-size: 1rem; background: #f9f9fc; }
    .radio-group { display: flex; gap: 24px; align-items: center; margin-bottom: 4px; }
    .radio-group label { margin-bottom: 0; font-weight: 400; }
    .btn-primary { background: #00B5D3; color: #fff; border: none; border-radius: 100px; padding: 14px 0; font-size: 1.1rem; font-weight: 500; cursor: pointer; transition: background 0.2s; margin-top: 8px; }
    .btn-primary:hover { background: #009bb8; }
    .msg-erro { color: #cf2e2e; font-size: 0.98rem; margin-top: 2px; }
    .msg-sucesso { color: #00B5D3; font-size: 1.05rem; margin-top: 10px; text-align: center; }
    @media (max-width: 600px) {
      .container-main { padding: 18px 6vw; }
      .titulo { font-size: 1.4rem; }
    }
  </style>
</head>
<body>
  <main class="container-main" aria-label="Aceite da Transportadora">
    <h1 class="titulo">Aceite de Transporte</h1>
    <p class="subtitulo">Confirme ou recuse o transporte e preencha os dados do veículo e motorista.</p>
    <dl class="detalhes-transporte">
      <dt>Solicitação:</dt>
      <dd>#123456 - FOB | Origem: Fornecedor XPTO | Destino: Unidade ICL SP</dd>
      <dt>Data de Coleta:</dt>
      <dd>12/07/2024, 10:00 - 12:00</dd>
      <dt>Tipo de Carga:</dt>
      <dd>Paletizado | Volume: 18 paletes | Peso: 7.200 kg</dd>
      <dt>Transportadora:</dt>
      <dd>TransLogística Brasil</dd>
      <dt>Volume:</dt>
      <dd id="ddVolume">-</dd>
      <dt>Tipo de Carga:</dt>
      <dd id="ddTipoCarga">-</dd>
      <dt>Peso Total:</dt>
      <dd id="ddPeso">-</dd>
      <dt>Confirmou Janela:</dt>
      <dd id="ddConfirmaJanela">-</dd>
      <dt>Nova Data/Hora (se aplicável):</dt>
      <dd id="ddNovaDataHora">-</dd>
    </dl>
    <form id="formAceite" autocomplete="off" novalidate>
      <div class="form-group">
        <label for="aceite">Aceite do Transporte <span aria-label="obrigatório" style="color:#cf2e2e">*</span></label>
        <div class="radio-group">
          <input type="radio" id="aceiteSim" name="aceite" value="sim" required>
          <label for="aceiteSim">Sim</label>
          <input type="radio" id="aceiteNao" name="aceite" value="nao">
          <label for="aceiteNao">Não</label>
        </div>
        <span class="msg-erro" id="erroAceite"></span>
      </div>
      <div class="form-group">
        <label for="placa">Placa do Veículo <span aria-label="obrigatório" style="color:#cf2e2e">*</span></label>
        <input type="text" id="placa" name="placa" maxlength="8" placeholder="Ex: ABC1D23" aria-required="true" autocomplete="off">
        <span class="msg-erro" id="erroPlaca"></span>
      </div>
      <div class="form-group">
        <label for="cpf">CPF do Motorista <span aria-label="obrigatório" style="color:#cf2e2e">*</span></label>
        <input type="text" id="cpf" name="cpf" maxlength="14" placeholder="Ex: 123.456.789-00" aria-required="true" autocomplete="off">
        <span class="msg-erro" id="erroCpf"></span>
      </div>
      <div class="form-group">
        <label for="nome">Nome do Motorista <span aria-label="obrigatório" style="color:#cf2e2e">*</span></label>
        <input type="text" id="nome" name="nome" maxlength="60" placeholder="Nome completo" aria-required="true" autocomplete="off">
        <span class="msg-erro" id="erroNome"></span>
      </div>
      <div class="form-group">
        <label for="celular">Celular do Motorista <span aria-label="obrigatório" style="color:#cf2e2e">*</span></label>
        <input type="tel" id="celular" name="celular" maxlength="15" placeholder="Ex: (11) 91234-5678" aria-required="true" autocomplete="off">
        <span class="msg-erro" id="erroCelular"></span>
      </div>
      <button type="submit" class="btn-primary" aria-label="Confirmar Aceite">Confirmar</button>
      <div class="msg-sucesso" id="msgSucesso" style="display:none;"></div>
    </form>
  </main>
  <script>
    // Máscara de placa (Mercosul ou padrão antigo)
    function maskPlaca(v) {
      v = v.toUpperCase().replace(/[^A-Z0-9]/g, '');
      if(v.length > 7) v = v.slice(0,7);
      return v;
    }
    document.getElementById('placa').addEventListener('input', function(e) {
      this.value = maskPlaca(this.value);
    });
    // Máscara CPF
    function maskCPF(v) {
      v = v.replace(/\D/g, '');
      v = v.replace(/(\d{3})(\d)/, '$1.$2');
      v = v.replace(/(\d{3})(\d)/, '$1.$2');
      v = v.replace(/(\d{3})(\d{1,2})$/, '$1-$2');
      return v;
    }
    document.getElementById('cpf').addEventListener('input', function(e) {
      this.value = maskCPF(this.value);
    });
    // Máscara celular
    function maskCelular(v) {
      v = v.replace(/\D/g, '');
      v = v.replace(/^([0-9]{2})([0-9]{5})([0-9]{4}).*/, '($1) $2-$3');
      if(v.length < 15) v = v.replace(/^\((\d{2})\)(\d{4})(\d{0,4})$/, '($1) $2-$3');
      return v;
    }
    document.getElementById('celular').addEventListener('input', function(e) {
      this.value = maskCelular(this.value);
    });
    // Validações
    function validarCPF(cpf) {
      cpf = cpf.replace(/\D/g, '');
      if (cpf.length !== 11 || /^([0-9])\1+$/.test(cpf)) return false;
      let soma = 0, resto;
      for (let i = 1; i <= 9; i++) soma += parseInt(cpf.substring(i-1, i)) * (11 - i);
      resto = (soma * 10) % 11;
      if ((resto === 10) || (resto === 11)) resto = 0;
      if (resto !== parseInt(cpf.substring(9, 10))) return false;
      soma = 0;
      for (let i = 1; i <= 10; i++) soma += parseInt(cpf.substring(i-1, i)) * (12 - i);
      resto = (soma * 10) % 11;
      if ((resto === 10) || (resto === 11)) resto = 0;
      if (resto !== parseInt(cpf.substring(10, 11))) return false;
      return true;
    }
    function validarPlaca(placa) {
      placa = placa.toUpperCase();
      return /^[A-Z]{3}[0-9][A-Z0-9][0-9]{2}$/.test(placa) || /^[A-Z]{3}-[0-9]{4}$/.test(placa);
    }
    function validarCelular(cel) {
      return /\(\d{2}\) \d{4,5}-\d{4}/.test(cel);
    }
    document.getElementById('formAceite').addEventListener('submit', function(e) {
      e.preventDefault();
      let ok = true;
      // Limpa erros
      ['Aceite','Placa','Cpf','Nome','Celular'].forEach(id => document.getElementById('erro'+id).textContent = '');
      document.getElementById('msgSucesso').style.display = 'none';
      // Aceite
      const aceite = document.querySelector('input[name="aceite"]:checked');
      if (!aceite) {
        document.getElementById('erroAceite').textContent = 'Selecione uma opção.';
        ok = false;
      } else if (aceite.value === 'nao') {
        document.getElementById('msgSucesso').textContent = 'Transporte recusado. A ICL será notificada.';
        document.getElementById('msgSucesso').style.display = 'block';
        return;
      }
      // Placa
      const placa = document.getElementById('placa').value.trim();
      if (!placa || !validarPlaca(placa)) {
        document.getElementById('erroPlaca').textContent = 'Placa inválida.';
        ok = false;
      }
      // CPF
      const cpf = document.getElementById('cpf').value.trim();
      if (!cpf || !validarCPF(cpf)) {
        document.getElementById('erroCpf').textContent = 'CPF inválido.';
        ok = false;
      }
      // Nome
      const nome = document.getElementById('nome').value.trim();
      if (!nome) {
        document.getElementById('erroNome').textContent = 'Informe o nome do motorista.';
        ok = false;
      }
      // Celular
      const celular = document.getElementById('celular').value.trim();
      if (!celular || !validarCelular(celular)) {
        document.getElementById('erroCelular').textContent = 'Celular inválido.';
        ok = false;
      }
      if (ok) {
        document.getElementById('msgSucesso').textContent = 'Aceite registrado com sucesso!';
        document.getElementById('msgSucesso').style.display = 'block';
        setTimeout(function(){ window.location.href = 'checkin-coleta.html'; }, 1200);
      }
    });
    // Preencher dados de confirmação do fornecedor
    (function preencherDadosConfirmacao() {
      var dados = null;
      try {
        dados = JSON.parse(localStorage.getItem('dadosConfirmacao'));
      } catch(e) { dados = null; }
      document.getElementById('ddVolume').textContent = dados && dados.volume ? dados.volume : '-';
      document.getElementById('ddTipoCarga').textContent = dados && dados.tipo_carga ? dados.tipo_carga.charAt(0).toUpperCase() + dados.tipo_carga.slice(1) : '-';
      document.getElementById('ddPeso').textContent = dados && dados.peso ? dados.peso + ' kg' : '-';
      document.getElementById('ddConfirmaJanela').textContent = dados && dados.confirma_janela ? (dados.confirma_janela === 'sim' ? 'Sim' : 'Não') : '-';
      var novaDataHora = '-';
      if (dados && dados.confirma_janela === 'nao' && (dados.nova_data || dados.nova_hora)) {
        novaDataHora = (dados.nova_data ? dados.nova_data : '') + (dados.nova_data && dados.nova_hora ? ' ' : '') + (dados.nova_hora ? dados.nova_hora : '');
      }
      document.getElementById('ddNovaDataHora').textContent = novaDataHora;
    })();
  </script>
</body>
</html>