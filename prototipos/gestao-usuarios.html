<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Gestão de Usuários | Gestão de Frestes</title>
  <link rel="stylesheet" href="https://bra.icl-group.com/wp-content/themes/hello-elementor/style.css?ver=6.8.3">
  <link rel="stylesheet" href="https://bra.icl-group.com/wp-content/themes/icl/css/general.min.css?ver=1761724536">
  <link rel="stylesheet" href="https://bra.icl-group.com/wp-content/themes/icl/css/new-styles.min.css?ver=1761724536">
  <link rel="stylesheet" href="https://bra.icl-group.com/wp-content/plugins/elementor/assets/lib/font-awesome/css/all.min.css?ver=1761639274">
  <style>
    body { font-family: 'Demo', 'Inter', sans-serif; background: #f6f9fa; margin: 0; }
    .main-header { background: #002846; color: #fff; padding: 0; }
    .main-header nav { display: flex; gap: 32px; align-items: center; }
    .main-header nav a { color: #fff; text-decoration: none; font-weight: 500; padding: 18px 24px; border-radius: 33px; transition: background .2s; }
    .main-header nav a.active, .main-header nav a:hover { background: #00B5D3; color: #fff; }
    .container { max-width: 1200px; margin: 32px auto; padding: 0 24px; }
    h1 { color: #002846; font-size: 2.2rem; margin-bottom: 24px; }
    .user-table { width: 100%; border-collapse: collapse; margin-bottom: 24px; background: #f8fbfc; border-radius: 8px; overflow: hidden; }
    .user-table th, .user-table td { padding: 8px 12px; border-bottom: 1px solid #e1e9ee; text-align: left; font-size: 0.98rem; }
    .user-table th { background: #00B5D3; color: #fff; font-weight: 500; }
    .user-table tr:last-child td { border-bottom: none; }
    .badge { display: inline-block; padding: 4px 12px; border-radius: 12px; font-size: 0.95rem; font-weight: 500; color: #fff; }
    .badge-admin { background: #cf2e2e; }
    .badge-operador { background: #00B5D3; }
    .badge-fornecedor { background: #61CE70; }
    .badge-transportadora { background: #fcb900; color: #002846; }
    .toggle-switch { position: relative; display: inline-block; width: 44px; height: 22px; }
    .toggle-switch input { opacity: 0; width: 0; height: 0; }
    .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background: #e1e9ee; border-radius: 22px; transition: .2s; }
    .slider:before { position: absolute; content: ""; height: 18px; width: 18px; left: 2px; bottom: 2px; background: #00B5D3; border-radius: 50%; transition: .2s; }
    .toggle-switch input:checked + .slider { background: #61CE70; }
    .toggle-switch input:checked + .slider:before { background: #61CE70; transform: translateX(22px); }
    .user-actions { display: flex; gap: 8px; }
    .user-btn { background: #00B5D3; color: #fff; border: none; border-radius: 8px; padding: 6px 14px; font-size: 0.98rem; cursor: pointer; transition: background .2s; }
    .user-btn:hover { background: #002846; }
    .filter-bar { display: flex; gap: 18px; margin-bottom: 18px; flex-wrap: wrap; align-items: center; }
    .filter-bar label { font-weight: 500; color: #002846; margin-right: 8px; }
    .filter-bar select, .filter-bar input { padding: 7px 12px; border: 1px solid #00284640; border-radius: 8px; font-size: 1rem; }
    .modal-bg { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100vw; height: 100vh; background: rgba(0,40,70,0.18); }
    .modal { display: none; position: fixed; z-index: 1001; left: 50%; top: 50%; transform: translate(-50%, -50%); background: #fff; border-radius: 18px; box-shadow: 0 8px 32px rgba(0,181,211,0.16); width: 98vw; max-width: 480px; max-height: 90vh; overflow-y: auto; padding: 32px 28px; }
    .modal-header { font-size: 1.3rem; font-weight: 500; color: #002846; margin-bottom: 18px; }
    .modal-close { position: absolute; right: 22px; top: 18px; font-size: 1.4rem; color: #002846; cursor: pointer; }
    .form-section { margin-bottom: 18px; }
    .form-section label { font-weight: 500; color: #002846; display: block; margin-bottom: 6px; }
    .form-section input, .form-section select { width: 100%; padding: 7px 12px; border: 1px solid #00284640; border-radius: 8px; font-size: 1rem; margin-bottom: 8px; }
    .form-section input[type='checkbox'] { width: auto; margin-right: 8px; }
    .audit-section { margin-top: 32px; }
    .audit-table { width: 100%; border-collapse: collapse; margin-bottom: 12px; background: #f8fbfc; border-radius: 8px; overflow: hidden; }
    .audit-table th, .audit-table td { padding: 7px 10px; border-bottom: 1px solid #e1e9ee; text-align: left; font-size: 0.95rem; }
    .audit-table th { background: #002846; color: #fff; font-weight: 500; }
    .audit-table tr:last-child td { border-bottom: none; }
    @media (max-width: 900px) { .container { padding: 0 8px; } .modal { max-width: 98vw; } }
  </style>
</head>
<body>
  <header class="main-header">
    <nav aria-label="Menu principal">
      <a href="relatorios.html">Relatórios</a>
      <a href="cadastros.html">Cadastros</a>
      <a href="gestao-usuarios.html" class="active">Gestão de Usuários</a>
    </nav>
  </header>
  <main class="container">
    <h1>Gestão de Usuários</h1>
    <div class="filter-bar">
      <label for="filtroPerfil">Perfil:</label>
      <select id="filtroPerfil">
        <option value="">Todos</option>
        <option value="admin">Administrador</option>
        <option value="operador">Operador ICL</option>
        <option value="fornecedor">Fornecedor</option>
        <option value="transportadora">Transportadora</option>
      </select>
      <label for="filtroStatus">Status:</label>
      <select id="filtroStatus">
        <option value="">Todos</option>
        <option value="ativo">Ativo</option>
        <option value="inativo">Inativo</option>
      </select>
      <input type="text" id="filtroBusca" placeholder="Buscar por nome ou e-mail..." aria-label="Buscar usuário">
      <button class="user-btn" id="novoUsuarioBtn"><i class="fas fa-user-plus"></i> Novo Usuário</button>
    </div>
    <table class="user-table" id="userTable">
      <thead>
        <tr>
          <th>Nome</th>
          <th>E-mail</th>
          <th>Perfil</th>
          <th>Status</th>
          <th>Último Acesso</th>
          <th>Ações</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
    <div class="modal-bg" id="modalBg"></div>
    <div class="modal" id="modalUser" aria-modal="true" role="dialog">
      <span class="modal-close" id="closeModal" aria-label="Fechar modal">&times;</span>
      <div class="modal-header" id="modalHeader">Novo Usuário</div>
      <div id="modalContent"></div>
    </div>
    <section class="audit-section">
      <h2 style="color:#002846;font-size:1.3rem;margin-bottom:10px;">Log de Auditoria</h2>
      <table class="audit-table" id="auditTable">
        <thead>
          <tr><th>Timestamp</th><th>Usuário</th><th>Ação</th><th>IP</th></tr>
        </thead>
        <tbody></tbody>
      </table>
    </section>
  </main>
  <script>
    // Mock de usuários
    let usuarios = [
      {nome:'Ana Souza', email:'ana@icl.com', perfil:'admin', status:true, acesso:'2024-06-10 08:21', empresa:'ICL'},
      {nome:'Carlos Lima', email:'carlos@icl.com', perfil:'operador', status:true, acesso:'2024-06-09 16:42', empresa:'ICL'},
      {nome:'João Silva', email:'joao@forn.com', perfil:'fornecedor', status:true, acesso:'2024-06-08 11:10', empresa:'Fornecedor A'},
      {nome:'Maria Oliveira', email:'maria@transp.com', perfil:'transportadora', status:false, acesso:'2024-06-07 13:05', empresa:'Transp. Alfa'}
    ];
    let auditoria = [
      {ts:'2024-06-10 08:22', usuario:'Ana Souza', acao:'Criou usuário Carlos Lima', ip:'192.168.1.12'},
      {ts:'2024-06-09 16:43', usuario:'Carlos Lima', acao:'Alterou status de Maria Oliveira', ip:'192.168.1.15'},
      {ts:'2024-06-08 11:11', usuario:'João Silva', acao:'Atualizou e-mail', ip:'192.168.1.22'}
    ];
    // Renderização da tabela de usuários
    function renderUsuarios() {
      const perfil = document.getElementById('filtroPerfil').value;
      const status = document.getElementById('filtroStatus').value;
      const busca = document.getElementById('filtroBusca').value.toLowerCase();
      let rows = '';
      usuarios.forEach((u,idx) => {
        if(perfil && u.perfil!==perfil) return;
        if(status && ((status==='ativo'&&!u.status)||(status==='inativo'&&u.status))) return;
        if(busca && !(u.nome.toLowerCase().includes(busca)||u.email.toLowerCase().includes(busca))) return;
        rows += `<tr>
          <td>${u.nome}</td>
          <td>${u.email}</td>
          <td>${badgePerfil(u.perfil)}</td>
          <td><label class='toggle-switch'><input type='checkbox' ${u.status?'checked':''} onchange='toggleStatus(${idx})'><span class='slider'></span></label></td>
          <td>${u.acesso}</td>
          <td class='user-actions'><button class='user-btn' onclick='editarUsuario(${idx})'>Editar</button><button class='user-btn' onclick='desativarUsuario(${idx})'>Desativar</button></td>
        </tr>`;
      });
      document.querySelector('#userTable tbody').innerHTML = rows;
    }
    function badgePerfil(p) {
      if(p==='admin') return '<span class="badge badge-admin">Admin</span>';
      if(p==='operador') return '<span class="badge badge-operador">Operador ICL</span>';
      if(p==='fornecedor') return '<span class="badge badge-fornecedor">Fornecedor</span>';
      if(p==='transportadora') return '<span class="badge badge-transportadora">Transportadora</span>';
      return '';
    }
    document.getElementById('filtroPerfil').onchange = renderUsuarios;
    document.getElementById('filtroStatus').onchange = renderUsuarios;
    document.getElementById('filtroBusca').oninput = renderUsuarios;
    // Modal de usuário
    const modalBg = document.getElementById('modalBg');
    const modalUser = document.getElementById('modalUser');
    const modalHeader = document.getElementById('modalHeader');
    const modalContent = document.getElementById('modalContent');
    document.getElementById('novoUsuarioBtn').onclick = function() { openUserModal(); };
    document.getElementById('closeModal').onclick = closeModal;
    modalBg.onclick = closeModal;
    function openUserModal(idx) {
      modalBg.style.display = 'block';
      modalUser.style.display = 'block';
      modalHeader.textContent = idx==null?'Novo Usuário':'Editar Usuário';
      let user = idx!=null?usuarios[idx]:{nome:'',email:'',perfil:'admin',empresa:'',status:true};
      modalContent.innerHTML = `
        <form id='formUsuario'>
          <div class='form-section'>
            <label for='nomeUsuario'>Nome</label>
            <input id='nomeUsuario' type='text' required value='${user.nome}'>
          </div>
          <div class='form-section'>
            <label for='emailUsuario'>E-mail</label>
            <input id='emailUsuario' type='email' required value='${user.email}'>
          </div>
          <div class='form-section'>
            <label for='perfilUsuario'>Perfil</label>
            <select id='perfilUsuario' onchange='updateEmpresaField()'>
              <option value='admin' ${user.perfil==='admin'?'selected':''}>Administrador</option>
              <option value='operador' ${user.perfil==='operador'?'selected':''}>Operador ICL</option>
              <option value='fornecedor' ${user.perfil==='fornecedor'?'selected':''}>Fornecedor</option>
              <option value='transportadora' ${user.perfil==='transportadora'?'selected':''}>Transportadora</option>
            </select>
          </div>
          <div class='form-section' id='empresaField' style='display:${(user.perfil==='fornecedor'||user.perfil==='transportadora')?'block':'none'};'>
            <label for='empresaUsuario'>Empresa vinculada</label>
            <input id='empresaUsuario' type='text' value='${user.empresa||''}' placeholder='Nome da empresa'>
          </div>
          <div class='form-section'>
            <label><input type='checkbox' id='enviaBemVindo' checked> Enviar e-mail de boas-vindas</label>
          </div>
          <button type='submit' class='user-btn'>Salvar</button>
        </form>
      `;
      document.getElementById('formUsuario').onsubmit = function(e){ e.preventDefault(); alert('Usuário salvo! (simulação)'); closeModal(); };
      window.updateEmpresaField = function() {
        const perfil = document.getElementById('perfilUsuario').value;
        document.getElementById('empresaField').style.display = (perfil==='fornecedor'||perfil==='transportadora')?'block':'none';
      }
    }
    function closeModal() {
      modalBg.style.display = 'none';
      modalUser.style.display = 'none';
      modalContent.innerHTML = '';
    }
    window.editarUsuario = function(idx) { openUserModal(idx); };
    window.desativarUsuario = function(idx) { usuarios[idx].status = false; renderUsuarios(); alert('Usuário desativado (simulação)'); };
    window.toggleStatus = function(idx) { usuarios[idx].status = !usuarios[idx].status; renderUsuarios(); };
    // Renderização do log de auditoria
    function renderAuditoria() {
      document.querySelector('#auditTable tbody').innerHTML = auditoria.map(a=>`<tr><td>${a.ts}</td><td>${a.usuario}</td><td>${a.acao}</td><td>${a.ip}</td></tr>`).join('');
    }
    renderUsuarios();
    renderAuditoria();
  </script>
</body>
</html>